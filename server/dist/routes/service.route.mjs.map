{"version":3,"sources":["../../src/routes/service.route.ts","../../src/models/service.model.ts","../../src/controller/service.controller.ts","../../src/middleware/protect-route.ts"],"sourcesContent":["import express,{Router} from \"express\"\r\nimport { createService, deleteService, getAllService, updateService } from \"../controller/service.controller\";\r\nimport { protectRoute } from \"../middleware/protect-route\";\r\n\r\n\r\nconst serviceRouter: Router = express.Router();\r\n\r\n\r\n\r\nserviceRouter.route(\"/service\").post(protectRoute, createService).get(protectRoute,getAllService)\r\nserviceRouter.route(\"/service/:id\").put(updateService).delete(deleteService)\r\n\r\n\r\nexport default serviceRouter","import mongoose, { Document, Schema, Model } from \"mongoose\";\r\n\r\n\r\n\r\nconst ServiceSchema = new mongoose.Schema(\r\n    {\r\n        serviceName : {\r\n            type: String,\r\n            required:true\r\n        },\r\n        description:{\r\n            type: String,\r\n            required:true\r\n        },\r\n         userId: mongoose.Types.ObjectId\r\n    },\r\n    {\r\n        timestamps: true\r\n    }\r\n)\r\n\r\nconst ServiceModel = mongoose.model(\"Service\",ServiceSchema)\r\nexport default ServiceModel","import { Request, Response } from \"express\";\r\nimport ServiceModel from \"../models/service.model\";\r\n\r\nexport const createService = async (\r\n  req: Request,\r\n  res: Response,\r\n): Promise<void> => {\r\n  try {\r\n    const { serviceName, description } = req.body;\r\n    const userId = req.user?.id;\r\n\r\n    const service = new ServiceModel({ serviceName, description, userId });\r\n\r\n    await service.save();\r\n    res.status(200).json({ message: true, serviceName });\r\n  } catch (error) {\r\n    res.status(200).json({ message: false, error });\r\n  }\r\n};\r\n\r\nexport const updateService = async (\r\n  req: Request,\r\n  res: Response,\r\n): Promise<void> => {\r\n  try {\r\n    const { id } = req.params;\r\n    const { serviceName } = req.body;\r\n\r\n    // Find service by ID and update it\r\n    const updatedService = await ServiceModel.findByIdAndUpdate(\r\n      id,\r\n      { serviceName },\r\n      { new: true, runValidators: true },\r\n    );\r\n\r\n    if (!updatedService) {\r\n      res.status(404).json({ message: false, error: \"Service not found\" });\r\n      return;\r\n    }\r\n\r\n    res.status(200).json({ message: true, service: updatedService });\r\n  } catch (error) {\r\n    res.status(500).json({ message: false, error: error });\r\n  }\r\n};\r\n\r\nexport const getAllService = async (\r\n  req: Request,\r\n  res: Response,\r\n): Promise<void> => {\r\n  try {\r\n    const userId = req.user?.id;\r\n    console.log(userId);\r\n\r\n    const service = await ServiceModel.find({ userId: userId });\r\n    res.status(200).json({ message: true, service });\r\n  } catch (error) {\r\n    res.status(200).json({ message: true, error });\r\n  }\r\n};\r\n\r\nexport const deleteService = async (\r\n  req: Request,\r\n  res: Response,\r\n): Promise<void> => {\r\n  try {\r\n    const { id } = req.params;\r\n\r\n    const service = await ServiceModel.findById(id);\r\n\r\n    if (!service) {\r\n      res.status(404).json({ message: false, error: \"Service not found\" });\r\n      return;\r\n    }\r\n\r\n    await service.deleteOne();\r\n    res.status(200).json({ message: true, id });\r\n  } catch (error) {\r\n    res.status(500).json({ message: false, error: error });\r\n  }\r\n};\r\n","import { Request, Response, NextFunction } from \"express\";\r\nimport jwt from \"jsonwebtoken\";\r\n\r\n// Use the secret key from environment variable or fallback to a default value\r\nconst SECRET_KEY = process.env.JWT_SECRET || \"your-secret-key\"; \r\n\r\n// Middleware function to protect routes\r\nexport const protectRoute = (req: Request, res: Response, next: NextFunction): void => {\r\n  const authHeader = req.headers.authorization || req.cookies.token;\r\n\r\n  if (!authHeader || !authHeader.startsWith(\"Bearer \")) {\r\n    res.status(401).json({ message: \"Unauthorized access. No token provided.\" });\r\n    return;\r\n  }\r\n\r\n  const token = authHeader.split(\" \")[1];\r\n\r\n  try {\r\n    const decoded = jwt.verify(token, SECRET_KEY) as { id: string };\r\n\r\n    req.user = { id: decoded.id };\r\n\r\n    next();\r\n  } catch (error) {\r\n    res.status(401).json({ message: \"Invalid or expired token.\" });\r\n  }\r\n};\r\n"],"mappings":"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","names":[]}